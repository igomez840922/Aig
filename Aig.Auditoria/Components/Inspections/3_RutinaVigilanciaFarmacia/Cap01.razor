@using DataModel.Helper;
@implements IDisposable

@if (Inspeccion != null)
{
    <div class="kt-content  kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor" id="kt_content">

        <div class="kt-container  kt-container--fluid  kt-grid__item kt-grid__item--fluid">

            <div class="row">
                <div class="col-xl-12">
                    <div class="kt-portlet">
                        <div class="kt-portlet__head">
                            <div class="kt-portlet__head-label">
                                <h3 class="kt-portlet__head-title">
                                    @(Inspeccion != null && Inspeccion.Id > 0 ? "ACTA: " + Inspeccion.NumActa : @languageContainerService.Keys["NewInspection"]) - @(DataModel.Helper.Helper.GetDescription(Inspeccion.TipoActa))
                                </h3>
                            </div>
                            <div class="kt-portlet__head-toolbar">
                                <div class="kt-portlet__head-actions">
                                    <button type="button" class="btn btn-danger btn-sm btn-bold"
                                        @onclick="(e)=>{Cancel();}">
                                        @languageContainerService.Keys["Cerrar"]
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="kt-portlet__body kt-portlet__body--fit">                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="kt-portlet__body">
                                        <EditForm OnValidSubmit="SaveData" EditContext="@editContext">
                                            <DataAnnotationsValidator />
                                            <div class="row clearfix">
                                                <div class="col-12">
                                                    <h5>@languageContainerService.Keys["GeneralInfo"]</h5>
                                                </div>
                                            </div>
                                            <div class="row clearfix">
                                                <div class="col-sm-4">
                                                    <label>@languageContainerService.Keys["Fecha de Evaluación"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <RadzenDatePicker TValue="DateTime" @bind-Value="Inspeccion.FechaInicio" ShowTime="true" HourFormat="12" DateFormat="dd/MM/yyyy h:mm tt" />
                                                            <ValidationMessage For=@(() => Inspeccion.FechaInicio) />
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            <div class="row clearfix">
                                                <div class="col-sm-8">

                                                    <label>@languageContainerService.Keys["Name"]</label>
                                                    <div class="input-group">
                                                        <InputText disbled class="form-control" @bind-Value="Inspeccion.DatosEstablecimiento.Nombre" />
                                                        <div class="input-group-append">
                                                            <button type="button" class="btn btn-secondary" @onclick="(e)=>{OpenSearchEstablishment();}"><i class="fa fa-search"></i></button>
                                                        </div>
                                                    </div>
                                                    <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.Nombre) />

                                                </div>
                                                <div class="col-sm-4">
                                                    <label for="password">@languageContainerService.Keys["LicNumber"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <InputText class="form-control" @bind-Value="Inspeccion.DatosEstablecimiento.NumLicencia" />
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.NumLicencia) />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label>@languageContainerService.Keys["Vigente Desde"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <RadzenDatePicker TValue="DateTime?" @bind-Value="Inspeccion.DatosEstablecimiento.VigenteDesde" ShowTime="false" DateFormat="dd/MM/yyyy" />
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.VigenteDesde) />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label>@languageContainerService.Keys["Vigente Hasta"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <RadzenDatePicker TValue="DateTime?" @bind-Value="Inspeccion.DatosEstablecimiento.VigenteHasta" ShowTime="false" DateFormat="dd/MM/yyyy" />
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.VigenteHasta) />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label for="password">@languageContainerService.Keys["Aviso de Operaciones"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <InputText class="form-control" @bind-Value="Inspeccion.DatosEstablecimiento.AvisoOperaciones" />
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.AvisoOperaciones) />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label for="password">@languageContainerService.Keys["Recibo de Pago"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <InputText class="form-control" @bind-Value="Inspeccion.DatosEstablecimiento.ReciboPago" />
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.ReciboPago) />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row clearfix">
                                                <div class="col-sm-4">
                                                    <label>@languageContainerService.Keys["Province"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <RadzenDropDown AllowClear="true" TValue="DataModel.ProvinciaTB" Class="form-control" @bind-Value=@Inspeccion.DatosEstablecimiento.Provincia
                                                                        AllowFiltering="true" FilterCaseSensitivity="@Radzen.FilterCaseSensitivity.CaseInsensitive" FilterOperator="@Radzen.StringFilterOperator.Contains"
                                                                        Data=@LProvincias TextProperty="Nombre"></RadzenDropDown>
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.Provincia) />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label>@languageContainerService.Keys["District"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <RadzenDropDown AllowClear="true" TValue="DataModel.DistritoTB" Class="form-control" @bind-Value=@Inspeccion.DatosEstablecimiento.Distrito
                                                                        AllowFiltering="true" FilterCaseSensitivity="@Radzen.FilterCaseSensitivity.CaseInsensitive" FilterOperator="@Radzen.StringFilterOperator.Contains"
                                                                        Data=@(LDistritos.Where(x=>x.ProvinciaId == Inspeccion.DatosEstablecimiento.Provincia?.Id)) TextProperty="Nombre"></RadzenDropDown>
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.Distrito) />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label>@languageContainerService.Keys["Corregimiento"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <RadzenDropDown AllowClear="true" TValue="DataModel.CorregimientoTB" Class="form-control" @bind-Value=@Inspeccion.DatosEstablecimiento.Corregimiento
                                                                        AllowFiltering="true" FilterCaseSensitivity="@Radzen.FilterCaseSensitivity.CaseInsensitive" FilterOperator="@Radzen.StringFilterOperator.Contains"
                                                                        Data=@(LCorregimiento.Where(x=>x.DistritoId == Inspeccion.DatosEstablecimiento.Distrito?.Id)) TextProperty="Nombre"></RadzenDropDown>
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.Corregimiento) />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row clearfix">
                                                <div class="col-sm-12">
                                                    <label for="password">@languageContainerService.Keys["Ubication"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <InputText class="form-control" @bind-Value="Inspeccion.DatosEstablecimiento.Direccion" />
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.Direccion) />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row clearfix">
                                                <div class="col-sm-4">
                                                    <label for="password">@languageContainerService.Keys["PhoneNumber"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <InputText class="form-control" @bind-Value="Inspeccion.DatosEstablecimiento.Telefono" />
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.Telefono) />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-4">
                                                    <label for="password">@languageContainerService.Keys["Email"]</label>
                                                    <div class="form-group">
                                                        <div class="form-line">
                                                            <InputText class="form-control" @bind-Value="Inspeccion.DatosEstablecimiento.Correo" />
                                                            <ValidationMessage For=@(() => Inspeccion.DatosEstablecimiento.Correo) />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            
                                            <div class="row clearfix">
                                                <div class="col-sm-12">
                                                    <label>@languageContainerService.Keys["DNFDParticipants"]</label>
                                                </div>
                                                <!--begin::Section-->
                                                <div class="col-sm-12">
                                                    <div class="table-responsive">
                                                        <table class="table rounded table-striped">
                                                            <thead class=thead-light>
                                                                <tr>
                                                                    <th>@languageContainerService.Keys["FullName"]</th>
                                                                    <th>@languageContainerService.Keys["IdentificationCard"]</th>
                                                                    <th>@languageContainerService.Keys["RegisterNumber"]</th>
                                                                    <th>@languageContainerService.Keys["Charge"]</th>
                                                                    <th style="text-align:right;">
                                                                        <button type="button" @onclick="(e)=>{OpenParticipant();}"
                                                                                class="btn btn-sm btn-outline-primary waves-effect">
                                                                            @languageContainerService.Keys["Add"]
                                                                        </button>
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @if (Inspeccion?.ParticipantesDNFD?.LParticipantes != null)
                                                                {
                                                                    @foreach (var dt in Inspeccion.ParticipantesDNFD.LParticipantes)
                                                                    {
                                                                        <tr>
                                                                            <td scope="row">@dt.NombreCompleto</td>
                                                                            <td>@dt.CedulaIdentificacion</td>
                                                                            <td>@dt.RegistroNumero</td>
                                                                            <td>@dt.Cargo</td>
                                                                            <td style="text-align:right">
                                                                                <div class="btn-group">
                                                                                    <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">@languageContainerService.Keys["Actions"]</button>
                                                                                    <div class="dropdown-menu">
                                                                                        <a class="dropdown-item" href="javascript:void(0)" @onclick="(e)=>{OpenParticipant(dt);}" data-toggle="modal" data-target="#modal_createedit" data-ktportlet-tool="edit"><i class="fa fa-edit"></i>@languageContainerService.Keys["Edit"]</a>
                                                                                        <a class="dropdown-item" href="javascript:void(0)" @onclick="(e)=>{RemoveParticipant(dt);}"><i class="fa fa-trash"></i>@languageContainerService.Keys["Delete"]</a>
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                            <br><br>

                                            <div class="kt-portlet__foot" style="text-align:right;">
                                                <div class="kt-form__actions">
                                                    
                                                    <button type="submit" @onclick="(e)=>{exit=true;}"
                                                        class="btn btn-success waves-effect">
                                                        @languageContainerService.Keys["SaveExit"]
                                                    </button>

                                                    <button type="submit"
                                                            class="btn btn-info waves-effect">
                                                        @languageContainerService.Keys["Save"]
                                                    </button>

                                                    <button type="button" class="btn btn-danger waves-effect"
                                                    @onclick="(e)=>{Cancel();}">
                                                        @languageContainerService.Keys["Cerrar"]
                                                    </button>

                                                </div>
                                            </div>


                                        </EditForm>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (showSearchEstablishment)
    {
        <Aig.Auditoria.Components.Establishments.SearchComponent></Aig.Auditoria.Components.Establishments.SearchComponent>
    }
    @if (showParticipant)
    {
        <Aig.Auditoria.Components.Participants.AddEditParticipantComponent Participante="@participante"></Aig.Auditoria.Components.Participants.AddEditParticipantComponent>
    }
}
