@page "/details/{product:int?}"
@*@layout MainLayout*@
@using System.Linq
@using Aig.Farmacoterapia.Application.Dashboard.Event
@using Aig.Farmacoterapia.Application.Dashboard.Model
@using System.Globalization
@using Aig.Farmacoterapia.Application.Medicament.Model
@using Aig.Farmacoterapia.Domain.Common
@using Aig.Farmacoterapia.Domain.Entities
@using Aig.Farmacoterapia.Domain.Interfaces
@using Aig.Farmacoterapia.Infrastructure.Configuration
@using BlazorComponentBus
@using Microsoft.Extensions.Options
@inject ISystemLogger _systemLogger;
@inject IUnitOfWork _unitOfWork;
@inject IOptions<AppConfiguration> _config;
<style>
   .product-details-img {
    background-color: #f8f8f8 !important;
    border: 1px solid #e9e9e9 !important;
    padding: 20px !important;
}
.product-02-list ul li {
    padding:0 !important;
}
.pro-details-icon > a {
    color: #f8f9fa !important;
    font-size: 25px!important;
    border: 1px solid #e9e9e9 !important;
    background-color: #6da5f4  !important;
}
.pro-details-icon > a:hover {
    color: #f8f9fa !important;
    font-size: 25px!important;
    border: 1px solid #e9e9e9 !important;
    background-color: #4e97fd !important;
}
</style>

@if (loading)
{
    <MudOverlay Visible="loading" LightBackground="true" Absolute="true">
        <MudProgressCircular Size="Size.Large" Color="Color.Info" Indeterminate="true" />
    </MudOverlay>
}
else
{
    <div class="col-xl-9 col-lg-9">
        <div class="pro-ful-tab">

            <div class="row">
                <div class="col-xl-4 col-lg-4">
                    
                    <div class="product-details-img">
                        <div class="tab-content" id="myTabContent2">
                            <div class="tab-pane fade show active" id="home" role="tabpanel">
                                <div class="product-large-img">
                                   
                                    @if (!string.IsNullOrEmpty(@item?.PictureData))
                                    {
                                        <img src="@item?.PictureData" Width="350" Height="300" Elevation="25" Class="rounded-lg" />
                                    }
                                    else
                                    {
                                        <img src="assets/img/products/pr-11.png" Width="350" Height="300" Elevation="25" Class="rounded-lg" />
                                    }

                                </div>



                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-8 col-lg-8">
                    <div class="product-details-wrapper mb-30">
                        <div class="product-text">
                            <h5 style="color: #e4573d !important;">@item?.NumReg</h5>
                            <h4>@item?.Nombre</h4>
                        </div>

                          <div class="product-02-list">
                                <ul>
                                    <li>
                                        <div class="pro-02-list-info f-left">
                                            <span>Principio Activo</span>
                                            <p>
                                                @item?.Principio
                                            </p>
                                        </div>
                                    </li>
                                     <li>
                                        <div class="pro-02-list-info f-left">
                                            <span>Exipientes</span>
                                            <p>
                                                @item?.Excipientes
                                            </p>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                        <div class="product-variant">

                            <div class="pro-details-icon">
                                <a title="Monografía" href="@($"{_config.Value?.BaseUrl}{item.ProspectusURL}")">
                                    <i class="fa fa-file-pdf"></i>
                                 </a>
                               <a title="Prospecto" href="@($"{_config.Value?.BaseUrl}{item.ProspectusURL}")">
                                    <i class="fa fa-file-powerpoint"></i>
                                 </a>
                               
                            </div>
                          
                        </div>
                    </div>
                </div>
            </div>
           
       </div>
    </div>
}
@code {
    [Parameter]
    public int product { get; set; } = 0;
    protected bool loading { get; set; } = true;
    private MudPagination _mudPagination;
    private AigMedicamento item;
    protected async override Task OnInitializedAsync()
    {
        //Subscribe Search Event
        Bus.Subscribe<SearchChangeEvent>(SearchChangeEventHandler);
        item=await DoFetchData();
        base.OnInitialized();
    }
    private void SearchChangeEventHandler(MessageArgs args)
    {
        var message = args.GetMessage<SearchChangeEvent>();
        if (message is SearchChangeEvent)
        {
            var value = message.Filter;
            ;
        }
    }
    private async Task<AigMedicamento> DoFetchData()
    {
        loading = true;
        var result = await _unitOfWork.Repository<AigMedicamento>().GetByIdAsync(product);
        if (result == null)
            result = new AigMedicamento();
        loading = false;
        return result;
       
    }
   
}