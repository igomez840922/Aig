@page "/details/{product:int?}"
@*@layout MainLayout*@
@using System.Linq
@using Aig.Farmacoterapia.Application.Dashboard.Event
@using Aig.Farmacoterapia.Application.Dashboard.Model
@using System.Globalization
@using Aig.Farmacoterapia.Application.Medicament.Model
@using Aig.Farmacoterapia.Domain.Common
@using Aig.Farmacoterapia.Domain.Entities
@using Aig.Farmacoterapia.Domain.Interfaces
@using Aig.Farmacoterapia.Infrastructure.Configuration
@using BlazorComponentBus
@using Microsoft.Extensions.Options
@inject ISystemLogger _systemLogger;
@inject IUnitOfWork _unitOfWork;
@inject IOptions<AppConfiguration> _config;

<style>
    .product-details-img {
        background-color: #f8f8f8 !important;
        border: 1px solid #e9e9e9 !important;
        padding: 20px !important;
    }

    .product-02-list ul li {
        padding: 0 !important;
    }

    .pro-details-icon > a {
        color: #f8f9fa !important;
        font-size: 25px !important;
        border: 1px solid #e9e9e9 !important;
        background-color: #6da5f4 !important;
        border-radius: 50% !important;
    }

    .pro-details-icon > a:hover {
        color: #f8f9fa !important;
        font-size: 25px !important;
        border: 1px solid #e9e9e9 !important;
        background-color: #4e97fd !important;
    }

    .product-details-wrapper .product-text h4 {
      font-size: 20px !important;
    }

</style>

@if (loading)
{
    <MudOverlay Visible="loading" LightBackground="true" Absolute="true">
        <MudProgressCircular Size="Size.Large" Color="Color.Info" Indeterminate="true" />
    </MudOverlay>
}
else
{
    <div class="col-xl-9 col-lg-9">
        <div class="pro-ful-tab">

            <div class="row">
                <div class="col-xl-4 col-lg-4">

                    <div class="product-details-img">
                        <div class="tab-content" id="myTabContent2">
                            <div class="tab-pane fade show active" id="home" role="tabpanel">
                                <div class="product-large-img">

                                    @if (!string.IsNullOrEmpty(@item?.PictureData))
                                    {
                                        <img src="@item?.PictureData" Width="350" Height="300" Elevation="25" Class="rounded-lg" />
                                    }
                                    else
                                    {
                                        <img src="assets/img/products/pr-11.png" Width="350" Height="300" Elevation="25" Class="rounded-lg" />
                                    }

                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-8 col-lg-8">
                    <div class="product-details-wrapper mb-30">
                        <div class="product-text">

                            <div class="container">
                                <div class="row">

                                    <div class="col-9">
                                        <div class="pro-02-list-info f-left">
                                            @if (!string.IsNullOrEmpty(item?.NumReg))
                                            {
                                                <h5 style="color: #e4573d !important;">
                                                    @($"Reg. {item.NumReg}")
                                                </h5>
                                            }
                                            <h4>
                                                @if (@item.Vigente)
                                                {
                                                    <span title="Virgente" class="fa fa-check-circle" aria-hidden="true" style="cursor: pointer;font-size: 20px;margin-right:7px;">
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span title="Caducado" class="fa fa-times-circle" aria-hidden="true" style="cursor: pointer;color: #e4573d !important;font-size: 20px;margin-right:7px">
                                                    </span>
                                                }
                                                @item?.Nombre
                                            </h4>
                                            @if (@item?.FechaExpiracion != null)
                                            {
                                                <h5 style="font-size: 12px !important;color: #e4573d !important;">
                                                    <span style="font-size: 12px !important;color: #e4573d !important;"> Vence:</span>
                                                    @(string.Format("{0:dd/MM/yyyy}",item.FechaExpiracion))
                                                </h5>
                                            }
                                        </div>
                                    </div>
                                    <div class="col-3">
                                        <div class="pro-02-list-info f-right">

                                            <div class="pro-details-icon">
                                                @if (!string.IsNullOrEmpty(item?.DataSheetURL))
                                                {
                                                    <a target="_blank" title="Monografía" href="@($"{_config.Value?.BaseUrl}{item.DataSheetURL}")">
                                                        <i class="fa fa-file-pdf"></i>
                                                    </a>
                                                }
                                                @if (!string.IsNullOrEmpty(item?.ProspectusURL))
                                                {
                                                    <a target="_blank" title="Prospecto" href="@($"{_config.Value?.BaseUrl}{item.ProspectusURL}")">
                                                        <i class="fa fa-file-powerpoint"></i>
                                                    </a>
                                                }

                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>



                        </div>

                        <hr style="margin: 0 0 1rem 0 !important;" />

                        
                            <div class="container">
                                 
                                <div class="row">
                                    @if (!string.IsNullOrEmpty(item.Principio))
                                    {
                                        <div class="col-12">
                                            <div class="pro-02-list-info f-left">
                                                <span>Principio Activo</span>
                                                <p>
                                                    @item?.Principio
                                                </p>

                                            </div>
                                        </div>
                                    }

                                </div>
                                <div class="row">

                                    @if (@item?.Excipientes != null)
                                    {
                                        <div class="col-12">
                                            <div class="pro-02-list-info f-left">
                                                <span>Exipientes</span>
                                                <p>
                                                    @item?.Excipientes
                                                </p>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>

                        <hr style="margin: 0 0 1rem 0 !important;" />

                        <div class="product-02-list">

                            <div class="container">
                                <div class="row">
                                    @if (@item?.FormaFarmaceutica != null)
                                    {
                                        <div class="col-6">
                                            <div class="pro-02-list-info f-left">
                                                <span>Forma farmacéutica </span>
                                                <p>
                                                    @item.FormaFarmaceutica.Nombre
                                                </p>

                                            </div>
                                        </div>
                                    }
                                    @if (@item?.ViaAdministracion != null)
                                    {
                                        <div class="col-6">
                                            <div class="pro-02-list-info f-left">
                                                <span>Vía de administración</span>
                                                <p>
                                                    @item.ViaAdministracion.Nombre
                                                </p>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>

                            <hr style="margin: 0 0 1rem 0 !important;" />

                            <div class="container">
                                <div class="row">

                                    <div class="col-4">
                                        <div class="pro-02-list-info f-left">
                                            <span>Condición de Venta</span>
                                            <p>
                                                @GetSaleCondition(item?.CondicionVenta)
                                            </p>

                                        </div>
                                    </div>

                                    <div class="col-4">
                                        <div class="pro-02-list-info f-left">
                                            <span>Clasificación</span>
                                            <p>
                                                @GetEquivalence(item?.TipoEquivalencia)
                                            </p>
                                        </div>
                                    </div>

                                    <div class="col-4">
                                        <div class="pro-02-list-info f-left">
                                            <span>Tipo</span>
                                            <p>
                                                @GetMedicationType(item?.TipoMedicamento)
                                            </p>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <hr style="margin: 0 0 1rem 0 !important;" />

                            <div class="container">
                                <div class="row">
                                    @if (@item?.Fabricante != null)
                                    {
                                        <div class="col-4">
                                            <div class="pro-02-list-info f-left">
                                                <span>Fabricante</span>
                                                <p>
                                                    @(!string.IsNullOrEmpty(item.Fabricante.Correo)?$"{item.Fabricante.Nombre} ({item.Fabricante.Correo})":item.Fabricante.Nombre)
                                                </p>
                                            </div>
                                        </div>
                                    }
                                    @if (@item?.Fabricante?.Pais != null)
                                    {
                                        <div class="col-3">
                                            <div class="pro-02-list-info f-left">
                                                <span>País</span>
                                                <p>
                                                    @item.Fabricante.Pais.Nombre
                                                </p>
                                            </div>
                                        </div>
                                    }
                                    @if (!string.IsNullOrEmpty(item.Fabricante?.Direccion))
                                    {
                                        <div class="col-5">
                                            <div class="pro-02-list-info f-left">
                                                <span>Dirección</span>
                                                <p>
                                                    @item.Fabricante?.Direccion
                                                </p>
                                            </div>
                                        </div>
                                    }

                                </div>
                            </div>

                            <hr style="margin: 0 0 1rem 0 !important;" />

                            <div class="container">
                                 <div class="row">
                                    @if (!string.IsNullOrEmpty(item.Concentracion))
                                    {
                                        <div class="col-12">
                                            <div class="pro-02-list-info f-left">
                                                <span>Concentración</span>
                                                <p>
                                                    @item?.Concentracion
                                                </p>

                                            </div>
                                        </div>
                                    }

                                </div>
                                <div class="row">
                                    @if (!string.IsNullOrEmpty(item.Envase))
                                    {
                                        <div class="col-12">
                                            <div class="pro-02-list-info f-left">
                                                <span>Descripción del Envase</span>
                                                <p>
                                                    @item?.Envase
                                                </p>

                                            </div>
                                        </div>
                                    }

                                </div>
                               
                            </div>


                        </div>


                    </div>
                </div>
            </div>

        </div>
    </div>
}
@code {
    [Parameter]
    public int product { get; set; } = 0;
    protected bool loading { get; set; } = true;
    private MudPagination _mudPagination;
    private AigMedicamento item;
    protected async override Task OnInitializedAsync()
    {
        item = await DoFetchData();
        base.OnInitialized();
    }
    
    private async Task<AigMedicamento> DoFetchData()
    {
        loading = true;
        var result = await _unitOfWork.Repository<AigMedicamento>().GetByIdAsync(product);
        if (result == null)
            result = new AigMedicamento();
        loading = false;
        return result;

    }

    private string GetSaleCondition(string value)
    {
        return value switch
        {
            "SP" => "Sin prescripción médica",
            "CP" => "Con prescripción médica",
            "UH" => "Uso hospitalario exclusivo",
            "VP" => "Venta popular",
        };
    }
    private string GetEquivalence(string value)
    {
        return value switch
        {
            "I" => "Medicamento de Referencia",
            "R" => "Medicamento Intercambiable",
            "G" => "Medicamento Genérico",
            "M" => "Medicamento de Marca",
              _ => string.Empty
        };
    }

    private string GetMedicationType(string value)
    {
        return value switch
        {
            "OT" => "Intercambiablea",
            "SI" => "Síntisis Química",
            "RA" => "Radiofármacos",
            "HU" => "Huérfanos",
            "HO" => "Homeopáticos",
            "FF" => "Fitofármacos",
            "BT" => "Biotecnológicos",
            "BI" => "Biológicos",
              _ => string.Empty
        };
    }

}